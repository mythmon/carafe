!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.carafe=a():"undefined"!=typeof global?global.carafe=a():"undefined"!=typeof self&&(self.carafe=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=a("./utils.js");b.exports=d3.chart("Base",{initialize:function(){this.base.style("position","relative"),this.svg=this.base.append("svg").style("pointer-events","all");var a=c.compose(c.popThis,d3.select);this.layer("svg",this.svg,{dataBind:function(){var a=this.chart();return this.transition().duration(a.transitionTime()).attr("width",a.width()).attr("height",a.height()),this.data([])},insert:a,events:{enter:a}})},transform:function(a){return this.data=a,a},redraw:function(){return this.draw(this.data),this},width:c.property(600),height:c.property(400),padding:c.property([0,0,0,0]),transitionTime:c.property(700)})},{"./utils.js":6}],2:[function(a){a("./base.js");var b=a("./utils.js");d3.chart("Base").extend("CalendarHeatMap",{initialize:function(){function a(a){var c=a.chart();return a.attr("fill",b.compose(c.heat(),c.colorScale)).attr("width",c.cellSize).attr("height",c.cellSize).attr("transform",b.format("translate({0},{1})",b.compose(c.date(),j,c.cellScaleX),b.compose(c.date(),k,c.cellScaleY)))}function c(a){var c=a.chart();return a.text(d3.time.format("%b")).style("font-size",c.cellSize+"px").attr("x",b.add(b.compose(j,c.cellScaleX),1)).attr("y",.8*c.cellSize)}function d(a){var c=a.chart();return a.text(b.ident).attr("x",c.cellSize/2).attr("y",b.compose(b.add(b.index,.75),c.cellScaleY)).style("font-size",.75*c.cellSize+"px")}var e=this.svg.append("g").classed("hover",!0),f=this.svg.append("g").classed("days",!0),g=this.svg.append("g").classed("x axis",!0),h=this.svg.append("g").classed("y axis",!0),i=this.base.append("div").classed("tooltip",!0).style("display","none").style("position","absolute").style("left","-10px").style("top","10px").style("background","rgba(240, 240, 240, 0.95)").style("pointer-events","none");this.numScale=d3.scale.linear(),this.cellScaleX=d3.scale.linear(),this.cellScaleY=d3.scale.linear(),this.colorScale=d3.scale.linear();var j=function(a){return Math.floor(this.numScale(a)/7)}.bind(this),k=function(a){return this.numScale(a)%7}.bind(this),l=this;this.base.select("svg").on("mouseover",function(){var a=d3.select(d3.event.target),c=d3.event.target.__data__;if(!a.empty()&&void 0!==c){var d=a.attr("transform"),e=/.*translate\(([\-\d\.]+),([\-\d\.]+)\).*/.exec(d);e&&(d=b.format("translate({0.1}px,{0.2}px)",e)(),i.html(l.tooltipFormat()(c)).style("display","block").style("transform",d).style("-webkit-transform",d))}}).on("mouseout",function(){var a=d3.event.target;d3.select(a).filter("rect.pointer-target").empty()||i.style("display","none")}),this.layer("hover",e,{dataBind:function(){var a=this.chart();return this.append("rect").classed("pointer-target",!0).style("fill","none").style("pointer-events","all").attr("width",a.width()).attr("height",a.height()),this.data([])},insert:b.compose(b.popThis,d3.select)}),this.days=this.layer("days",f,{dataBind:function(a){return this.selectAll("rect").data(a)},insert:function(){var a=this.chart();return this.append("rect").attr("width",a.cellSize).attr("height",a.cellSize)},events:{enter:function(){this.call(a)},"update:transition":function(){var b=this.chart();this.duration(b.transitionTime()).call(a)},"exit:transition":function(){var a=this.chart();this.duration(a.transitionTime()/2).attr("width",0).attr("opacity",0).remove()}}}),this.layer("xAxis",g,{dataBind:function(a){for(var b=this.chart(),c=d3.extent(a,b.date()),d=new Date(c[0].getFullYear(),c[0].getMonth()+1,1),e=new Date(c[1].getFullYear(),c[1].getMonth(),1),f=[],g=d;e>=g;)f.push(g),g=new Date(g.getFullYear(),g.getMonth()+1,1);return this.attr("width",b.width()).attr("height",20).selectAll("text").data(f)},insert:function(){return this.append("text").classed("x label",!0).style("font-family","sans")},events:{enter:function(){return this.call(c)},"update:transition":function(){var a=this.chart();this.duration(a.transitionTime()).call(c)}}}),this.layer("yAxis",h,{dataBind:function(){return this.selectAll("text").data(["S","M","T","W","T","F","S"])},insert:function(){return this.append("text").classed("y label",!0).style("text-anchor","middle").style("font-family","sans")},events:{enter:function(){return this.call(d)},"update:transition":function(){var a=this.chart();this.duration(a.transitionTime()).call(d)},exit:function(){this.remove()}}})},transform:function(a){a=d3.chart("Base").prototype.transform.call(this,a);var b=d3.extent(a,this.date()),c=(a.length+b[0].getDay()+7-b[1].getDay())/7+1,d=(this.height()-7*this.cellGap())/8,e=this.width()/c-this.cellGap();return this.cellSize=Math.floor(Math.min(d,e)),this.numScale.domain([b[0],+b[0]+864e5]).range([b[0].getDay(),b[0].getDay()+1]),this.cellScaleX.domain([-1,0]).range([0,this.cellSize+this.cellGap()]),this.cellScaleY.domain([-1,0]).range([0,this.cellSize+this.cellGap()]),this.colorScale.domain(d3.extent(a,this.heat())).range(["rgba(0, 0, 255, 0.1)","rgba(0, 0, 255, 1.0)"]),a},width:b.property(700),height:b.property(100),cellGap:b.property(1),tooltipFormat:b.property(b.format("{0.date} - {0.heat}",b.ident)),color:b.property("#00f"),heat:b.property(b.get("heat")),date:b.property(b.get("date"))})},{"./base.js":1,"./utils.js":6}],3:[function(a,b){var c=a("./utils.js");a("./base.js"),a("./calendarheatmap.js"),a("./speclines.js"),a("./timeseries.js"),b.exports={utils:c}},{"./base.js":1,"./calendarheatmap.js":2,"./speclines.js":4,"./timeseries.js":5,"./utils.js":6}],4:[function(a){a("./base.js");var b=a("./utils.js");d3.chart("Base").extend("SpecLines",{initialize:function(){var a=this.svg.append("g").classed("lines",!0),c=this.svg.append("g").classed("axes",!0);this.scaleX=d3.scale.linear(),this.scaleY=d3.scale.linear(),this.zeroLine=d3.svg.line().x(b.compose(b.get(0),this.scaleX)).y(this.scaleY.bind(null,0)),this.line=d3.svg.line().x(b.compose(b.get(0),this.scaleX)).y(b.compose(b.get(1),this.scaleY)),this.layer("axes",c,{dataBind:function(){var a=this.chart();return this.selectAll("g.axis").data([d3.svg.axis().scale(a.scaleY).orient("left").ticks(4).tickSize(1),d3.svg.axis().scale(a.scaleX).orient("bottom").ticks(10).tickSize(1)])},insert:function(){return this.append("g").classed("axis",!0)},events:{enter:function(){var a=this.chart();this.each(function(c){var d=d3.select(this),e=0,f=0;"left"===c.orient()?e=30:"bottom"===c.orient()&&(f=a.height()-30),d.call(c).attr("transform",b.format("translate({0},{1})",e,f))})},"update:transition":function(){var a=this.chart();this.duration(a.transitionTime()).each(function(c){var d=d3.select(this),e=0,f=0;"left"===c.orient()?e=30:"bottom"===c.orient()&&(f=a.height()-30),d.attr("transform",b.format("translate({0},{1})",e,f)).call(c)})}}}),this.linesLayer=this.layer("lines",a,{dataBind:function(a){return this.selectAll("path").data(a)},insert:function(){return this.append("path").attr("strokeWidth",2).attr("fill","none")},events:{enter:function(){var a=this.chart();return this.attr("d",b.compose(b.get("points"),a.zeroLine)).attr("stroke","#000")},"enter:transition":function(){var a=this.chart();return this.delay(function(a,b){return 200*b}).duration(a.transitionTime()).attr("d",b.compose(b.get("points"),a.line)).attr("stroke",b.get("stroke"))},"update:transition":function(){var a=this.chart();return this.duration(a.transitionTime()).attr("d",b.compose(b.get("points"),a.line)).attr("stroke",b.get("stroke"))}}})},width:b.property(1e3),height:b.property(400),padding:b.property([5,0,30,30]),specs:b.property([]),transform:function(a){a=d3.chart("Base").prototype.transform.call(this,a);var b=1/0,c=-1/0,d=0,e=-1/0,f=this.specs().map(function(f){return{stroke:f.stroke||"#000",name:f.name,points:a.map(function(a){var g=f.x(a),h=f.y(a);return b>g&&(b=g),g>c&&(c=g),d>h&&(d=h),h>e&&(e=h),[g,h]})}}),g=this.padding()[3],h=this.width()-this.padding()[1],i=this.padding()[0],j=this.height()-this.padding()[2];return this.scaleX.range([g,h]).domain([b,c]),this.scaleY.range([j,i]).domain([d,e]),f}})},{"./base.js":1,"./utils.js":6}],5:[function(a){a("./speclines.js");var b=a("./utils.js");d3.chart("SpecLines").extend("TimeSeries",{initialize:function(){var a=this.base.append("svg").classed("brush",!0);this.base.selectAll("svg").style("display","block"),this.scaleX=d3.time.scale(),this.zeroLine=this.zeroLine.x(b.compose(b.get(0),this.scaleX)),this.line=this.line.x(b.compose(b.get(0),this.scaleX)),this.brush=d3.svutils.brush();var c=function(){var a=this.brush.extent();this.scaleX.domain(a),this.trigger("update"),this.brush.event(this.layer("lines"))};this.brushScale=this.scaleX.copy(),this.brush.on("brush",c.bind(this)),this.layer("brush",a,{dataBind:function(){var a=this.chart();return a.brushScale.domain(a.scaleX.domain()).range(a.scaleX.range()),a.brush.x(a.brushScale).extent(a.brushScale.domain()),this.transition().duration(a.transitionTime()).attr("width",a.width()).attr("height",50),this.call(a.brush).selectAll("rect").attr("height",50).style("stroke","#f00").style("fill","#0f0").style("fill-opacity",.5),d3.selectAll("rect").data([])},insert:b.compose(b.popThis,d3.select),events:{enter:b.compose(b.popThis,d3.select)}})},transform:function(a){return a=d3.chart("SpecLines").prototype.transform.call(this,a)}})},{"./speclines.js":4,"./utils.js":6}],6:[function(a,b){b.exports={},b.exports.get=function(){var a={};return function(b){return b in a||(a[b]=function(a){return a[b]}),a[b]}}(),b.exports.ident=function(a){return a},b.exports.property=function(a,c){var d=a;return c=c||b.exports.ident,function(a){return 0===arguments.length?d:(setTimeout(c.bind(this,a),0),d=a,this)}},b.exports.compose=function(){var a=Array.prototype.slice.call(arguments);return a.forEach(function(a,b){if("function"!=typeof a)throw"Argument #"+b+" is not a function: "+a}),function(b,c){var d=b;return a.forEach(function(a){d=a(d,c)}),d}},b.exports.add=function(){var a=Array.prototype.map.call(arguments,d3.functor);return function(b,c){var d=0;return a.forEach(function(a){d+=a(b,c)}),d}},b.exports.multiply=function(){var a=Array.prototype.map.call(arguments,d3.functor);return function(b,c){var d=1;return a.forEach(function(a){d*=a(b,c)}),d}},b.exports.index=function(a,b){return b},b.exports.popThis=function(){return this},b.exports.format=function(a){var c=Array.prototype.slice.call(arguments,1).map(d3.functor);return function(d){return a.replace(/\{[\d\w\.]+\}/g,function(a){a=a.slice(1,-1);a.split(".");return b.exports.dottedGet(a,d)(c)})}},b.exports.dottedGet=function(a,b){return a=a.split("."),function(c){for(var d=0;d<a.length;d++)if(c=d3.functor(c[a[d]])(b),void 0===c)return void 0;return c}}},{}]},{},[3])(3)});